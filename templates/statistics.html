{% extends "base.html" %} {% block title %}Statistics{% endblock %} {% block content %}
<style>
    .analytics-container {
        padding: 25px;
        background: var(--bg);
        min-height: 100vh;
    }

    .analytics-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: white;
        border-radius: 12px;
        border: 1px solid var(--border);
    }

    .analytics-header h1 {
        margin: 0 0 10px 0;
        font-size: 2rem;
        color: #1e293b;
    }

    .analytics-header p {
        color: var(--text-muted);
        margin: 0;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        transition:
            transform 0.2s,
            box-shadow 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .stat-card-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }

    .stat-icon {
        font-size: 2rem;
        line-height: 1;
    }

    .stat-title {
        font-size: 0.85rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 5px;
    }

    .stat-subtitle {
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .stat-player {
        font-weight: 600;
        color: var(--primary);
    }

    .section-title {
        font-size: 1.5rem;
        margin: 30px 0 20px 0;
        color: #1e293b;
        border-left: 4px solid var(--primary);
        padding-left: 15px;
    }

    .table-container {
        background: white;
        border: 1px solid var(--border);
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 30px;
    }

    .analytics-table {
        width: 100%;
        border-collapse: collapse;
    }

    .analytics-table thead {
        background: #f8fafc;
    }

    .analytics-table th {
        padding: 15px;
        text-align: left;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-muted);
        font-weight: 600;
    }

    .analytics-table td {
        padding: 15px;
        border-top: 1px solid #f1f5f9;
    }

    .analytics-table tbody tr:hover {
        background: #f8fafc;
    }

    .rank-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .rank-1 {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #92400e;
        box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
    }

    .rank-2 {
        background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
        color: #475569;
        box-shadow: 0 2px 8px rgba(192, 192, 192, 0.3);
    }

    .rank-3 {
        background: linear-gradient(135deg, #cd7f32, #e9a76f);
        color: #78350f;
        box-shadow: 0 2px 8px rgba(205, 127, 50, 0.3);
    }

    .rank-default {
        background: #e2e8f0;
        color: #64748b;
    }

    .percentage-bar {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 5px;
    }

    .percentage-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), #3b82f6);
        transition: width 0.3s ease;
    }

    .team-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .team-orange {
        background: #fed7aa;
        color: #9a3412;
    }

    .team-yellow {
        background: #fef08a;
        color: #713f12;
    }

    .streak-indicator {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        font-weight: 600;
    }

    .streak-fire {
        color: #dc2626;
    }

    .streak-ice {
        color: #0ea5e9;
    }

    .duo-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 8px;
        margin-bottom: 8px;
    }

    .duo-players {
        flex: 1;
        font-weight: 600;
        color: #1e293b;
    }

    .duo-stats {
        display: flex;
        gap: 15px;
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .highlight-box {
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border: 2px solid #0ea5e9;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .highlight-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #0c4a6e;
        margin-bottom: 10px;
    }

    .highlight-content {
        font-size: 1rem;
        color: #0c4a6e;
    }

    .no-data {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

    .no-data-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.3;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="analytics-container">
    <div class="analytics-header">
        <h1>üèÜ League Analytics</h1>
        <p>Performance insights and statistical deep dive</p>
    </div>

    {% if stats %}

    <!-- KEY STATS OVERVIEW -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">üéÆ</span>
                <span class="stat-title">Total Matches</span>
            </div>
            <div class="stat-value">{{ stats.total_matches }}</div>
            <div class="stat-subtitle">Games played this season</div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">üë•</span>
                <span class="stat-title">Active Players</span>
            </div>
            <div class="stat-value">{{ stats.active_players }}</div>
            <div class="stat-subtitle">Players with 1+ matches</div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">üéØ</span>
                <span class="stat-title">Most Active</span>
            </div>
            <div class="stat-value">{{ stats.most_active_player.games }}</div>
            <div class="stat-subtitle">
                {% if stats.most_active_player.tied_players|length > 1 %}
                <span class="stat-player">{{ stats.most_active_player.tied_players|join(' & ') }}</span>
                {% else %}
                <span class="stat-player">{{ stats.most_active_player.name }}</span>
                {% endif %} games played
            </div>
        </div>
    </div>
    <!-- HIGHLIGHT: CURRENT HOT STREAK -->
    {% if stats.hot_streak %}
    <div class="highlight-box">
        <div class="highlight-title">üî• Current Hot Streak</div>
        <div class="highlight-content">
            <strong>{{ stats.hot_streak.player }}</strong> is on fire with
            <strong>{{ stats.hot_streak.streak }}</strong> consecutive wins! {% if stats.hot_streak.streak >= 5 %}
            <span style="margin-left: 10px">üåü LEGENDARY!</span>
            {% elif stats.hot_streak.streak >= 3 %}
            <span style="margin-left: 10px">‚ú® Unstoppable!</span>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- STREAKS & RECORDS -->
    <h2 class="section-title">üî• Streaks & Records</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">üèÉ</span>
                <span class="stat-title">Longest Game Streak</span>
            </div>
            <div class="stat-value">{{ stats.longest_game_streak.streak }}</div>
            <div class="stat-subtitle">
                <span class="stat-player">{{ stats.longest_game_streak.player }}</span>
                <br>Consecutive matches played
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">üèÜ</span>
                <span class="stat-title">Longest Win Streak</span>
            </div>
            <div class="stat-value">{{ stats.longest_win_streak.streak }}</div>
            <div class="stat-subtitle">
                <span class="stat-player">{{ stats.longest_win_streak.player }}</span>
                <br>Consecutive wins
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">‚ùÑÔ∏è</span>
                <span class="stat-title">Longest Dry Spell</span>
            </div>
            <div class="stat-value">{{ stats.longest_losing_streak.streak }}</div>
            <div class="stat-subtitle">
                <span class="stat-player">{{ stats.longest_losing_streak.player }}</span>
                <br>Games without a win
            </div>
        </div>
    </div>

    <!-- WIN RATE RANKINGS -->
    <h2 class="section-title">üìà Win Rate Rankings</h2>
    <div class="table-container">
        <table class="analytics-table">
            <thead>
                <tr>
                    <th style="width: 60px">Rank</th>
                    <th>Player</th>
                    <th style="width: 80px; text-align: center">Played</th>
                    <th style="width: 80px; text-align: center">Wins</th>
                    <th style="width: 120px; text-align: center">Win Rate</th>
                    <th style="width: 200px">Performance</th>
                </tr>
            </thead>
            <tbody>
                {% for player in stats.win_rates %}
                <tr>
                    <td>
                        <span class="rank-badge rank-{{ loop.index if loop.index <= 3 else 'default' }}">
                            {{ loop.index }}
                        </span>
                    </td>
                    <td style="font-weight: 600">{{ player.name }}</td>
                    <td style="text-align: center">{{ player.games_played }}</td>
                    <td style="text-align: center; color: var(--success); font-weight: 600">{{ player.wins }}</td>
                    <td style="text-align: center; font-weight: 700; color: var(--primary)">
                        {{ "%.1f"|format(player.win_rate) }}%
                    </td>
                    <td>
                        <div class="percentage-bar">
                            <div class="percentage-fill" style="width: {{ player.win_rate }}%"></div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- BEST PAIRINGS -->
    <h2 class="section-title">ü§ù Best Team Pairings</h2>
    <div class="table-container">
        <table class="analytics-table">
            <thead>
                <tr>
                    <th style="width: 60px">Rank</th>
                    <th>Duo</th>
                    <th style="width: 100px; text-align: center">Games</th>
                    <th style="width: 100px; text-align: center">Wins</th>
                    <th style="width: 120px; text-align: center">Win Rate</th>
                    <th style="width: 150px; text-align: center">Chemistry</th>
                </tr>
            </thead>
            <tbody>
                {% for duo in stats.best_pairings %}
                <tr>
                    <td>
                        <span class="rank-badge rank-{{ loop.index if loop.index <= 3 else 'default' }}">
                            {{ loop.index }}
                        </span>
                    </td>
                    <td style="font-weight: 600">{{ duo.player1 }} & {{ duo.player2 }}</td>
                    <td style="text-align: center">{{ duo.games_together }}</td>
                    <td style="text-align: center; color: var(--success); font-weight: 600">
                        {{ duo.wins_together }}
                    </td>
                    <td style="text-align: center; font-weight: 700; color: var(--primary)">
                        {{ "%.1f"|format(duo.win_rate) }}%
                    </td>
                    <td style="text-align: center">
                        {% if duo.win_rate >= 70 %}
                        <span style="color: #16a34a; font-weight: 600">üî• Dominant</span>
                        {% elif duo.win_rate >= 55 %}
                        <span style="color: #2563eb; font-weight: 600">‚ú® Strong</span>
                        {% elif duo.win_rate >= 45 %}
                        <span style="color: #64748b">‚öñÔ∏è Balanced</span>
                        {% else %}
                        <span style="color: #dc2626">üíî Struggling</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- WORST PAIRINGS (for fun) -->
    {% if stats.worst_pairings %}
    <h2 class="section-title">üíî Challenging Pairings</h2>
    <div class="table-container">
        <table class="analytics-table">
            <thead>
                <tr>
                    <th>Duo</th>
                    <th style="width: 100px; text-align: center">Games</th>
                    <th style="width: 100px; text-align: center">Wins</th>
                    <th style="width: 120px; text-align: center">Win Rate</th>
                    <th style="width: 200px">Note</th>
                </tr>
            </thead>
            <tbody>
                {% for duo in stats.worst_pairings %}
                <tr>
                    <td style="font-weight: 600">{{ duo.player1 }} & {{ duo.player2 }}</td>
                    <td style="text-align: center">{{ duo.games_together }}</td>
                    <td style="text-align: center">{{ duo.wins_together }}</td>
                    <td style="text-align: center; font-weight: 700">{{ "%.1f"|format(duo.win_rate) }}%</td>
                    <td style="color: var(--text-muted); font-style: italic">Maybe try different teammates? ü§î</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- FUN FACTS -->
    {% if stats.fun_facts %}
    <h2 class="section-title">üéâ Fun Facts</h2>
    <div class="stats-grid">
        {% for fact in stats.fun_facts %}
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">{{ fact.icon }}</span>
                <span class="stat-title">{{ fact.title }}</span>
            </div>
            <div style="font-size: 1.1rem; color: #1e293b; margin-top: 10px">{{ fact.description }}</div>
        </div>
        {% endfor %}
    </div>
    {% endif %} {% else %}
    <!-- NO DATA STATE -->
    <div class="table-container">
        <div class="no-data">
            <div class="no-data-icon">üìä</div>
            <h3>No Analytics Available Yet</h3>
            <p>Play some matches to see your league statistics!</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
</div>
